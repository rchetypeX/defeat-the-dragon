exports.id=750,exports.ids=[750],exports.modules={5640:(e,s,t)=>{Promise.resolve().then(t.bind(t,5348))},9846:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,4424,23)),Promise.resolve().then(t.t.bind(t,7752,23)),Promise.resolve().then(t.t.bind(t,5275,23)),Promise.resolve().then(t.t.bind(t,9842,23)),Promise.resolve().then(t.t.bind(t,1633,23)),Promise.resolve().then(t.t.bind(t,9224,23))},5348:(e,s,t)=>{"use strict";t.d(s,{AuthProvider:()=>l,a:()=>d});var r=t(3227),o=t(3677),a=t(7517),n=t(3071);t(7392);let i=(0,o.createContext)(void 0);function l({children:e}){let[s,t]=(0,o.useState)(null),[l,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(!0),{setUser:g,resetGame:p}=(0,n.g)(),m=async(e,s)=>{let{error:t}=await a.O.auth.signInWithPassword({email:e,password:s});return{error:t}},y=async(e,s,t)=>{try{let r=await fetch("/api/auth/check-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(r.ok&&(await r.json()).exists)return{error:{message:"An account with this email already exists. Please sign in instead."}};let{error:o}=await a.O.auth.signUp({email:e,password:s,options:{data:{display_name:t},emailRedirectTo:`${window.location.origin}/auth/callback`}});if(o){if(console.log("Sign up error:",o.message),o.message.includes("already registered")||o.message.includes("already exists")||o.message.includes("User already registered")||o.message.includes("duplicate key")||o.message.includes("already been registered")||o.message.includes("User already registered")||o.message.includes("Email already registered"))return{error:{message:"An account with this email already exists. Please sign in instead."}};if(o.message.includes("password")||o.message.includes("Password"))return{error:{message:"Password must be at least 6 characters long."}};if(o.message.includes("email")||o.message.includes("Email"))return{error:{message:"Please enter a valid email address."}};return{error:o}}return{error:null}}catch(e){return console.error("Sign up error:",e),{error:{message:"An unexpected error occurred. Please try again."}}}},h=async()=>{await a.O.auth.signOut()};return r.jsx(i.Provider,{value:{user:s,session:l,loading:c,signIn:m,signUp:y,signOut:h},children:e})}function d(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7392:(e,s,t)=>{"use strict";t.d(s,{Xr:()=>i,v_:()=>l,yj:()=>n});var r=t(7517);async function o(){return console.log("API: Getting auth token..."),console.log("API: Using mock token for development"),"mock-token-for-development"}async function a(e,s={}){console.log("API: Making request to:",e);let t=await o();console.log("API: Got token, length:",t.length);let r=new AbortController,a=setTimeout(()=>{console.log("API: Request timeout, aborting..."),r.abort()},15e3);try{console.log("API: Making fetch request...");let o=await fetch(`/api${e}`,{...s,signal:r.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,...s.headers}});if(clearTimeout(a),console.log("API: Fetch request completed"),console.log("API: Response status:",o.status),!o.ok){let e=await o.json().catch(()=>({}));throw console.error("API: Request failed:",e),Error(e.error||`API request failed: ${o.status}`)}let n=await o.json();return console.log("API: Request successful, data:",n),n}catch(e){if(clearTimeout(a),"AbortError"===e.name)throw console.error("API: Request timed out"),Error("Request timed out");throw e}}async function n(e){console.log("API: startSession called with:",e);try{let s=await a("/sessions/start",{method:"POST",body:JSON.stringify(e)});return console.log("API: startSession response:",s),s}catch(e){throw console.error("API: startSession error:",e),e}}async function i(e){return a("/sessions/complete",{method:"POST",body:JSON.stringify(e)})}async function l(){try{console.log("API: getPlayerData called"),console.log("API: Starting getPlayerData execution");let{data:{user:e}}=await r.O.auth.getUser();if(console.log("API: Auth user check completed, user:",e?"exists":"null"),!e)return console.log("API: No authenticated user, returning mock data"),{id:"mock-player-id",user_id:"mock-user-id",level:1,xp:0,coins:3,sparks:0,is_inspired:!1,bond_score:50,mood_state:"Happy",day_streak:0,created_at:new Date().toISOString(),display_name:"The Moth"};console.log("API: Starting database queries for user:",e.id),console.log("API: Querying players table...");let s=await r.O.from("players").select("*").eq("user_id",e.id).single();console.log("API: Players query completed, error:",s.error),console.log("API: Querying profiles table...");let t=await r.O.from("profiles").select("display_name").eq("user_id",e.id).single();if(console.log("API: Profiles query completed, error:",t.error),console.log("API: All database queries completed"),s.error)throw console.error("API: Players table query failed:",s.error),Error(`Players query failed: ${s.error.message}`);t.error&&console.error("API: Profiles table query failed:",t.error);let o={...s.data,display_name:t.data?.display_name||"The Moth"};return console.log("API: Successfully retrieved player data:",{id:o.id,level:o.level,xp:o.xp,coins:o.coins,display_name:o.display_name}),console.log("API: getPlayerData completed successfully"),o}catch(e){throw console.error("API: Failed to get player data:",e),console.error("API: getPlayerData failed with error:",e.message),e}}},3071:(e,s,t)=>{"use strict";t.d(s,{g:()=>i});var r=t(1341),o=t(780),a=t(7392);let n={user:{id:null,email:null,isAuthenticated:!1},player:null,currentSession:null,inventory:[],classes:[],settings:{soundEnabled:!0,notificationsEnabled:!0,accessibility:{highContrast:!1,dyslexiaFont:!1,ttsEnabled:!1}},sessionProgress:{sessionId:null,startTime:null,durationMinutes:null,elapsedSeconds:0,isActive:!1,isDisturbed:!1,disturbedSeconds:0}},i=(0,r.Ue)()((0,o.mW)((0,o.tJ)((e,s)=>({...n,setUser:s=>e(e=>({user:s?{id:s.id,email:s.email,isAuthenticated:!0}:{id:null,email:null,isAuthenticated:!1}})),setPlayer:s=>e({player:s}),updatePlayer:s=>e(e=>({player:e.player?{...e.player,...s}:null})),loadPlayerData:async()=>{try{console.log("Store: Loading player data...");let s=await (0,a.v_)();console.log("Store: Player data loaded:",s),s?(console.log("Store: Setting player data in store"),e({player:s}),console.log("Store: Player data set successfully")):(console.log("Store: No player data returned"),e({player:null}))}catch(s){throw console.error("Store: Failed to load player data:",s),e({player:null}),s}},setCurrentSession:s=>e({currentSession:s}),startSession:async(t,r)=>{try{console.log("Store: Starting session with:",{action:t,durationMinutes:r});let o=await (0,a.yj)({action:t,duration_minutes:r});console.log("Store: API response:",o);let n={id:o.session_id,user_id:s().user.id,action:t,started_at:new Date().toISOString(),disturbed_seconds:0,dungeon_floor:0,boss_tier:"none"};console.log("Store: Created session object:",n),e({currentSession:n,sessionProgress:{sessionId:o.session_id,startTime:Date.now(),durationMinutes:r,elapsedSeconds:0,isActive:!0,isDisturbed:!1,disturbedSeconds:0}}),console.log("Store: Session state updated")}catch(o){console.error("Store: Failed to start session:",o);let s={id:"mock-session-id",user_id:"mock-user-id",action:t,started_at:new Date().toISOString(),disturbed_seconds:0,dungeon_floor:0,boss_tier:"none"};console.log("Store: Using mock session:",s),e({currentSession:s,sessionProgress:{sessionId:"mock-session-id",startTime:Date.now(),durationMinutes:r,elapsedSeconds:0,isActive:!0,isDisturbed:!1,disturbedSeconds:0}})}},stopSession:()=>e(e=>({currentSession:null,sessionProgress:{...e.sessionProgress,isActive:!1}})),completeSession:async t=>{try{let r=s();if(!r.currentSession||!r.sessionProgress.sessionId)throw Error("No active session to complete");let o=Math.floor((Date.now()-r.sessionProgress.startTime)/6e4);console.log("Completing session with:",{sessionId:r.currentSession.id,actualDurationMinutes:o,disturbedSeconds:r.sessionProgress.disturbedSeconds,outcome:t});let n=await (0,a.Xr)({session_id:r.currentSession.id,actual_duration_minutes:o,disturbed_seconds:r.sessionProgress.disturbedSeconds,outcome:t});return console.log("Session completion response:",n),r.player&&(console.log("Store: Updating player data with rewards:",{oldPlayer:r.player,rewards:{xp_gained:n.xp_gained,coins_gained:n.coins_gained,sparks_gained:n.sparks_gained,new_level:n.new_level,new_streak:n.new_streak}}),e({player:{...r.player,xp:r.player.xp+n.xp_gained,coins:r.player.coins+n.coins_gained,sparks:r.player.sparks+n.sparks_gained,level:n.new_level,day_streak:n.new_streak},currentSession:null,sessionProgress:{...r.sessionProgress,isActive:!1}}),console.log("Store: Player data and session state updated")),n}catch(o){console.error("Failed to complete session:",o);let t=s(),r={xp_gained:10,coins_gained:5,sparks_gained:t.player?.is_inspired?2:0,level_up:!1,new_level:t.player?.level||1,new_streak:1};return console.log("Store: Using mock completion response:",r),t.player&&e({player:{...t.player,xp:t.player.xp+r.xp_gained,coins:t.player.coins+r.coins_gained,sparks:t.player.sparks+r.sparks_gained,level:r.new_level,day_streak:r.new_streak},currentSession:null,sessionProgress:{...t.sessionProgress,isActive:!1}}),r}},updateSessionProgress:s=>e(e=>({sessionProgress:{...e.sessionProgress,...s}})),setInventory:s=>e({inventory:s}),addToInventory:s=>e(e=>({inventory:[...e.inventory,s]})),updateInventoryItem:(s,t)=>e(e=>({inventory:e.inventory.map(e=>e.id===s?{...e,...t}:e)})),setClasses:s=>e({classes:s}),unlockClass:s=>e(e=>({classes:e.classes.map(e=>e.class_id===s?{...e,unlocked:!0}:e)})),updateSettings:s=>e(e=>({settings:{...e.settings,...s}})),resetGame:()=>e(n)}),{name:"defeat-the-dragon-storage",partialize:e=>({settings:e.settings,user:e.user})}),{name:"defeat-the-dragon-store"}))},7517:(e,s,t)=>{"use strict";t.d(s,{O:()=>r});let r=(0,t(4793).eI)("https://zbqrrtjmavergvuddncs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpicXJydGptYXZlcmd2dWRkbmNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3MDcyNDYsImV4cCI6MjA3MTI4MzI0Nn0.F54csPdpCI6BBhc5NJ5HHJv7LU9xGUGLO1oeGzfUPHE")},959:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c,metadata:()=>l,viewport:()=>d});var r=t(9013),o=t(8747),a=t.n(o);t(1);var n=t(3189);let i=(0,n.createProxy)(String.raw`C:\Users\EL Bonuan\Documents\GitHub\defeat-the-dragon\apps\web\contexts\AuthContext.tsx#AuthProvider`);(0,n.createProxy)(String.raw`C:\Users\EL Bonuan\Documents\GitHub\defeat-the-dragon\apps\web\contexts\AuthContext.tsx#useAuth`);let l={title:"Defeat the Dragon",description:"A Pixel-art Pomodoro-style Focus RPG",manifest:"/manifest.json",appleWebApp:{capable:!0,statusBarStyle:"default",title:"Defeat the Dragon"},formatDetection:{telephone:!1}},d={width:"device-width",initialScale:1,maximumScale:1,userScalable:!1,themeColor:"#f2751a"};function c({children:e}){return(0,r.jsxs)("html",{lang:"en",children:[(0,r.jsxs)("head",{children:[r.jsx("link",{rel:"icon",href:"/favicon.ico"}),r.jsx("link",{rel:"apple-touch-icon",href:"/icons/icon-192x192.png"}),r.jsx("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),r.jsx("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),r.jsx("meta",{name:"apple-mobile-web-app-title",content:"Defeat the Dragon"}),r.jsx("meta",{name:"mobile-web-app-capable",content:"yes"}),r.jsx("meta",{name:"msapplication-TileColor",content:"#f2751a"}),r.jsx("meta",{name:"msapplication-tap-highlight",content:"no"})]}),r.jsx("body",{className:a().className,children:r.jsx(i,{children:e})})]})}},1:()=>{}};